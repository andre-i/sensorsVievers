<!DOCTYPE html>
<html lang="ru-RU" >
	<head>
		<meta charset="UTF-8" />
		<title>Справка по модулю </title>
		<script type="text/javascript"> </script>
		<style type="text/css">
		img{
			max-width : 100%;
			border : solid blue 2px;
		}
		 </style>
	</head>
	<body>
		<ul>
			<li><a href="#man">Справка по работе с устройством</a>
			<li><a href="#props">Настройки модуля</a>
			<li><a href="#compile">Создание и загрузка прошивки</a>
		</ul>
		<a name="man"><h2>Краткая справка по работе с устройством</h2></a>
		<div>
			Устройство предназначено для показа значений датчиков в браузере.
			Далее в тексте везде, где написано про ESP8266 так-же справедливо
			и для NodeMCU. 		
		</div>
		<div>
			Как это работает:
			<br> Кратко <br>&nbsp; Значения с присоединённых к ESP8266 датчиков считываются и через WI-FI сеть передаются на компьютер(телефон). Браузер устройства отображает полученные значения.<br>
			<br> Более подробно
			<ul>
				<li> При успешном старте ESP8266 будет создана точка доступа. Для просмотра показаний подключаемся к ней. <br><i>По умолчанию называется - ESP8266, пароль - my.esp8266</i>. Адрес в браузере 192.168.4.2 <br> <b>Важно !</b> Так-как соединение идёт по протоколу http(не защищённое) браузер( Chrom точно, остальные надо проверять ) может и отклонить соединение. В этом случае нужно в настройках браузера разрешить незащищённые соединения, и  перезагрузить страницу.
				<li>К модулю ESP8266 присоединяются датчики. Датчики присоединяются через разъёмы. 
					<br>&nbsp; 1) INA219 , BMP280, AHT20 (можно взять и совмещённые BMP280 c AHT20) - через один. <u>Протокол I2C</u>.
					<br>&nbsp; 2) DS18B20 - через другой. <u>Протокол one_wire</u>.
					<br><i>Присоединять можно как до включения, так и в процессе работы.</i>
				<li>Обновить список присоединённых устройств, нажав на кнопку <img src="refresh.png" width="24px" height="24px" alt="кнопка обновить">. Обновлять необходимо при манипуляциях с датчиками или по желанию. При данном действии ESP8266 проверит наличие подключенных датчиков и станет отправлять данные с них.
				<li>Кнопки присоединённых датчиков изменят цвет. 
				<br>По щелчку по таким кнопкам появляются приборные шкалы, на которых отображаются полученные значения. В верху страницы можно отобразить только одну или две шкалы. При количестве более двух надо прокрутить страницу вниз.
				<br>При повторном щелчке по кнопке данная шкала перестанет отображаться.
				<li> При щелчке по панели показания отобразятся на числовой панели. Для обратного перехода надо щёлкнуть по числовой панели.
				<li> При щелчке по кнопке <img src="quest.png" alt="Знак вопрроса" width="24px" height="24px" > будет показана эта страница.
				<li> Дополнительно каждая шкала имеет кнопки выбора отображаемого диапазона значений. При нажатии на которые меняются шкалы.
			</ul>
		</div>
		<h3 align="center">Рисунки с пояснениями<h3>
		<table >
			<tr>
				<td>
					<big>Страница появится при старте модуля</big><br>
					<img src='img/startPage.png' alt="Начальная страница">
				</td>
			</tr>
			<tr>
				<td>
					<big>Страница после нажатия на кнопку обновить.</big><br>
					<img src='img/after_refresh.png' alt="После обновления">
				</td>
			</tr>
			<tr>
				<td>
					<big>Показ значений датчиков</big><br>
					<img src="img/showData.png" alt="Показ данных">
				</td>
			</tr>
		</table>
		<h3 align="center">Схема электрическихсоединений</h3>
		<table >
			<tr><td>
			<img src="img/SensorsOnESP8266.png" alt="Схема электрических соединений"/>
			</td></tr>
		</table>
		<div>
			<big> Замечания по схеме </big><br>
			Далее используются названия обозначений из схемы.
			<ol>
				<li> Транзисторы Q1 и Q2 защитные от переполюсовки измеряемой цепи. Кнопка <i>protect_button</i> управляет защитным транзистором Q2. Второй транзистор нужен , если измеряемое напряжение меньше напряжения открытия транзистора Q1( обычно около 2.5 Вольт). 
				<br>&nbsp; При отсутствии подключенного к разъёму P1 источника будет небольшой сдвиг напряжения, при подключении источника с напряжением больше напряжения открывания транзистора Q1, транзистор откроется и датчик будет нормально работать. Если напряжение меньше напряжения открытия транзистора Q1 необходимо убедиться, в том, что полярность подключения верная. Проверку можно осуществить проверив светится-ли LED2 или полярность проверять другим способом, когда напряжение окажется меньше напряжения зажигания светодиода LED2(зависит от типа установленного светодиода).
				<li> Измерение модулем INA219 выполняется в следующем порядке
				<ul>
					<li>проверить, что светодиод LED1 не светится
					<Li>подключить измеряемую цепь
					<li>если напряжение более ~2.5В всё заработает.
					<li>Если светодиод LED2 не светится, убедиться в правильном подключении измеряемой цепи и нажать на кнопку <i>protect_buton</i>.
					<li> По окончании измерений отсоединить цепь и проверить свечение LED1. Если светится перемкнуть контакты 2 и 3 на P1 пока светодиод не погаснет.
					<li>Максимальные параметры измеряемых значений 
					<br>&nbsp; 1. Напряжение - 25В
					<br>&nbsp; 2. Ток - 5А
				<ul>
				</li>
				<li> Разъём H1(Обведён чёрным цветом) не нужен при использовании модуля NodeMCU. В этом случае питание подаётся через USB.
				<li> Разъёмы 2_a, 2_b, 2_c, 2_d должны соответствовать разъёму 2
				<br> Разъём 1_a соответствует разъёму 1_f
				<br> Обозначения разъёмов в красных кружках. Тип разъёмов любой, соблюдайте очерёдность по числовым обозначениям на разъёмах.
				<li><b>Важно</b> - Можно убрать из схемы танзисторы Q1 и Q2 с их обвязкой, при этом точность увеличится, зато защиты от переполюсовки нет совсем и забота о здоровье модуля ложится на пользователя.
			</ol>
		</div><!-- замечания по схеме -->
		<a name="props"><h3>Справка по настройке ESP8266</h3></a>
		<large>
		<pre>
===============   НАСТРОЙКИ  МОДУЛЯ  ==============================
В программу жёсто вшиты параметры сети - их вводить не нужно
 local_IP(192,168,4,2) - адрес чипа
 gateway(192,168,4,1)  - адрес шлюза
 subnet(255,255,255,0) - размерность сети


Перед работой модуль должен быть настроен. 
1.Обязательными являются настройки сети. 
2.Настройки интерфейсов I2C и oneWire могут не указываться( в таком случае
  используют значения из DefaultProps.h). 

3. Настройки записываются в файл. 
При повторном включени параметры заново не вводятся. 
При каждой смене каких-либо параметров абсолютно все настройки необходимо 
перезаписывать.

Файл настроек содержитследующие поля:
-------------------------------------------------------------------------
            параметр                         | значение по умолчанию  
-------------------------------------------------------------------------
   SSID - имя сети 			     | ESP8266 
   PASSWD - пароль сети не менее 8 символов  | my.esp8266 
   I2C_SCL - GPIO SCL интерфейса  I2C 	     | 5 
   I2C_SDA - GPIO SDA интерфейса I2C 	     | 4 
   ONE_WIRE - GPIO интерфейса OneWire 	     | 12 
-------------------------------------------------------------------------
Значения по умолчанию - для изменения 
 необходимо править defaultProps.h и перекомпилировать прошивку, ну и 
 схему придётся переделывать( если изменены номера пинов, при изменении
 логина и пароля схема остаётся прежней )


 I  Модуль работает как точка доступа вайфай сети. Для его работы необходимо 
вводить имя сети и её пароль - первые две настройки.

 II Следующие две настройки указывают на то, к каким пинам необходимо 
     присоединять I2C устройства. Если не знаете, что указывать, то для 
     связи с устройствами используйте :
                         GPIO5 модуля ESP8266( D1 - nodeMCU) - SCL
                         GPIO4 модуля ESP8266( D2 - nodeMCU) - SDA

 III Пятая настройка - номер пина для связи с oneWire устройством (DS18B20)
     По умолчанию стоит GPIO12 модуля ESP8266(D5 - nodeMCU)

(зачем надо переназначать пины не знаю, но пусть будет)

Всё ниже указано в файле 'properties.h'  и задаётся только при компиляции.

   LED_PIN - где подключен светодиод, NodeMCU это пин 2. Редко мигает - с
      модулями всё Ок ,часто мигает - ошибка

   MOSFET_PIN - подтянут к земле, управляет защитным транзистором, который 
      не обязателен, но при включении служит какой-никакой защитой. 
      Параллельно к этому пину подключен светодиод для индикации незащищённого 
      режима. 
      Светится  - внимание! Защиты нет вообще.

    BUTTON_PIN - подтянут к vcc задаёт режим защитного транзистора

====================================================================

для связи с модулем в адресную строку ввести 192.168.4.2


==================  команды  последовательного порта  ======================
============================================================================

возможно выполнение команд:
   'rp'(read properties) - чтение файла настроек
   'cr'(chip reset) - перезагрузка чипа
   'clear'(clear setting and reboot) - сброс настроек и перезагрузка
   'w'(write new values) - запись новых настроек
          DEBUG (ОТЛАДКА) 
  'dt'(debug true) - отладка включена
  'df'(debug false) - отладка отключена

При наборе других символов показывается файл справки(этот).



==================================  END  ========================================

	</pre>
	</large>
	<h3>Создание прошивки</h3>
	<a name="compile"></a>
	<ol>
		<li>Установить ArduinoIDE, если не установлено.
		<li>Скопировать с github репозиторий и распаковать в любую папку.
		<li>В ArduinoIDE загрузить библиотеки <i>OneWire, DallasTemperature, GyverINA, DFRobot_AHT20, Adafruit_BMP280.h, Wire</i>
		<li>В папке проэкта перейти в digitalSensors, запустить файл  digitalSensors.ino. Скомпилировать и загрузить прошивку в ESP8266
	<ol>
	<br>
	<div><big>Как выполнять вышеуказанные шаги посмотреть в интернете.</big>
<!-- end -->
	</body>
</html>
